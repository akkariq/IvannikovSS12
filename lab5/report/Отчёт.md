# Отчет по лабораторной работе №5
# Применение паттернов проектирования в системе учета сотрудников

**Дата:** 2024-12-06

**Семестр:** 2 курс, 1 полугодие - 3 семестр

**Группа:** ПИН-б-о-24-1

**Дисциплина:** Технологии программирования

**Студент:** Иванников Сергей Сергеевич

## Цель работы

Изучение и практическое применение порождающих, структурных и поведенческих паттернов проектирования на примере системы управления сотрудниками компании. Создание гибкой, расширяемой и поддерживаемой архитектуры программного обеспечения.

## Теоретическая часть

### Паттерны проектирования

Паттерны проектирования - это типичные решения часто встречающихся проблем в проектировании программного обеспечения. Они представляют собой не готовый код, а общую концепцию решения проблемы, которую можно адаптировать под конкретные нужды.

**Группы паттернов:**
1. **Порождающие** - отвечают за создание объектов
2. **Структурные** - определяют структуру классов и объектов
3. **Поведенческие** - определяют взаимодействие между объектами
4. **Комбинированные** - сочетают несколько паттернов для решения комплексных задач

### Принципы ООП, используемые в паттернах
- **Инкапсуляция** - сокрытие внутренней реализации
- **Наследование** - создание иерархий классов
- **Полиморфизм** - единый интерфейс для разных типов
- **Абстракция** - выделение существенных характеристик

## Практическая часть

### Выполненные задачи

#### Часть 1: Порождающие паттерны
- [x] **Singleton** - гарантирование единственного подключения к БД
- [x] **Factory Method** - рефакторинг существующей EmployeeFactory
- [x] **Abstract Factory** - создание фабрик для разных типов компаний
- [x] **Builder** - пошаговое создание сложных объектов сотрудников

#### Часть 2: Структурные паттерны
- [x] **Adapter** - интеграция с внешней системой расчета зарплат
- [x] **Decorator** - добавление дополнительной функциональности сотрудникам
- [x] **Facade** - создание упрощенного интерфейса для работы с системой

#### Часть 3: Поведенческие паттерны
- [x] **Observer** - реализация системы уведомлений об изменениях
- [x] **Strategy** - различные стратегии расчета бонусов
- [x] **Command** - система команд для операций с сотрудниками

#### Часть 4: Комбинированные паттерны
- [x] **Repository** - работа с данными через репозитории
- [x] **Unit of Work** - управление транзакциями
- [x] **Specification** - фильтрация сотрудников по критериям

### Ключевые фрагменты кода

#### 1. Singleton для подключения к БД
```python
class DatabaseConnection:
    _instance = None

    def __new__(cls):
        if cls._instance is None:
            cls._instance = super().__new__(cls)
            cls._instance._connection = None
        return cls._instance
```

#### 2. Abstract Factory для разных компаний
```python
class TechCompanyFactory(CompanyFactory):
    def create_company(self, name: str) -> Company:
        company = Company(name)
        company.add_department(self.create_department("Разработка", "DEV"))
        company.add_department(self.create_department("Тестирование", "QA"))
        return company
```

#### 3. Builder с Fluent-интерфейсом
```python
developer = (EmployeeBuilder()
            .set_id(101)
            .set_name("Иван Петров")
            .set_department("DEV")
            .set_base_salary(5000)
            .set_type("developer")
            .set_skills(["Python", "Java", "Docker"])
            .set_seniority("senior")
            .build())
```

#### 4. Adapter для внешней системы
```python
class SalaryAdapter:
    def __init__(self, external_system: ExternalSalarySystem):
        self._external_system = external_system

    def calculate_salary(self, employee: AbstractEmployee) -> float:
        employee_data = {
            'base': employee.base_salary,
            'bonus': employee.calculate_bonus()
        }
        return self._external_system.compute_compensation(employee_data)
```

#### 5. Decorator для добавления функциональности
```python
class BonusDecorator(EmployeeDecorator):
    def __init__(self, employee: AbstractEmployee, bonus_amount: float):
        super().__init__(employee)
        self._bonus_amount = bonus_amount

    def calculate_salary(self) -> float:
        return self._employee.calculate_salary() + self._bonus_amount
```

#### 6. Strategy для различных бонусов
```python
class PerformanceBonusStrategy(BonusStrategy):
    def calculate_bonus(self, employee: AbstractEmployee) -> float:
        return employee.base_salary * 0.1
```

#### 7. Command с возможностью отмены
```python
class HireEmployeeCommand(Command):
    def __init__(self, company: Company, employee: AbstractEmployee):
        self._company = company
        self._employee = employee
        self._executed = False

    def execute(self):
        self._company.hire_employee(self._employee)
        self._executed = True

    def undo(self):
        if self._executed:
            self._company.fire_employee(self._employee.id)
```

## Результаты выполнения

### Пример работы программы
```
==========================================================
ДЕМОНСТРАЦИЯ ПАТТЕРНОВ ПРОЕКТИРОВАНИЯ
==========================================================

1. SINGLETON (DatabaseConnection):
   db1 is db2: True
   Один и тот же экземпляр: True

2. ABSTRACT FACTORY (Создание разных компаний):
   Создана IT компания: TechCorp
   Отделы в IT компании: 3
   Создана Sales компания: SalesCorp
   Отделы в Sales компании: 3

3. BUILDER (Пошаговое создание сотрудников):
   Создан разработчик: Employee 101: Иван Петров, Dept: DEV, Salary: 10000.00
   Создан продавец: Employee 102: Анна Сидорова, Dept: SALES, Salary: 4500.00

4. FACTORY METHOD (Создание через фабрики):
   Создан через EmployeeFactory: Employee 201: Петр Иванов, Dept: HR, Salary: 2500.00
   Создан через DeveloperFactory: Employee 202: Мария Козлова, Dept: DEV, Salary: 6750.00

5. ADAPTER (Интеграция внешней системы):
   Зарплата через адаптер: 5000.0
   Зарплата обычным способом: 10000.0

6. DECORATOR (Добавление функциональности):
   Оригинал: Employee 101: Иван Петров, Dept: DEV, Salary: 10000.00
   С бонусом: Employee 101: Иван Петров, Dept: DEV, Salary: 10000.00 [+Bonus: 1000.0]
   С бонусом и обучением: Employee 101: Иван Петров, Dept: DEV, Salary: 10000.00 [+Bonus: 1000.0] | Training: Cloud Computing

7. FACADE (Упрощенный интерфейс):
   NOTIFICATION: [2024-03-15 14:30:45] Алексей Смирнов: Hired: Алексей Смирнов
   Расчет зарплат через фасад: {'total': 4000.0, 'count': 1, 'average': 4000.0}

8. OBSERVER (Система уведомлений):
   NOTIFICATION: [2024-03-15 14:30:45] Иван Петров: Salary changed from 5000 to 5500
   Уведомлений отправлено: 1

9. STRATEGY (Разные стратегии бонусов):
   Бонус по производительности: 550.00
   Бонус за опыт: 1100.00
   Бонус за проекты: 1500.00

10. COMMAND (Операции с отменой):
   Executed: Hire Мария Козлова
   Undone: Hire Мария Козлова

11. REPOSITORY (Работа с данными):
   Сотрудников в репозитории: 2
   Сотрудник с ID 101: Иван Петров

12. UNIT OF WORK (Транзакции):
   Перед коммитом: изменения зарегистрированы
   Committing: 1 new, 1 dirty, 0 removed
   После коммита: изменения применены

13. SPECIFICATION (Фильтрация сотрудников):
   Сотрудники с зарплатой > 4000 в отделе DEV со знанием Python: 1
     - Иван Петров: 10000.00

==========================================================
ИТОГОВАЯ ДЕМОНСТРАЦИЯ ВЗАИМОДЕЙСТВИЯ ПАТТЕРНОВ
==========================================================
   Декорированный сотрудник: Employee 1: Дмитрий Волков, Dept: DEV, Salary: 6000.00 [+Bonus: 1500.0] | Training: Advanced Python

Финальная статистика:
- Всего сотрудников: 3
- Разработчиков с зарплатой > 4000: 2
- Общие затраты на зарплаты: 17500.00

Демонстрация отмены операции:
   Executed: Hire Тестовый Сотрудник
   После найма: 4 сотрудников
   Undone: Hire Тестовый Сотрудник
   После отмены: 3 сотрудников

==========================================================
ДЕМОНСТРАЦИЯ ЗАВЕРШЕНА
==========================================================
```

### Тестирование
- [x] Модульные тесты пройдены (все классы создаются корректно)
- [x] Интеграционные тесты пройдены (паттерны корректно взаимодействуют)
- [x] Производительность соответствует требованиям (быстрое выполнение операций)


## Приложения
- **Исходный код:** [Полный код реализации системы](https://raw.githubusercontent.com/akkariq/IvannikovSS12/main/lab-05/project/sourcecode.py) 
- **Диаграммы:** [UML диаграмма классов системы с паттернами](https://github.com/akkariq/IvannikovSS12/blob/main/lab5/report/uml.png)
- **Дополнительные материалы:** Примеры использования каждого паттерна в демонстрационной функции
